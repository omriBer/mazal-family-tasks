<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>מז"ל – משימות למשפחה</title>

  <!-- CSS ראשי -->
  <link rel="stylesheet" href="style.css" />

  <!-- מאפשר להתקין כמו אפליקציה במסך הבית -->
  <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;מז״ל&quot;,&quot;short_name&quot;:&quot;מז״ל&quot;,&quot;display&quot;:&quot;standalone&quot;}" />
  <meta name="theme-color" content="#ffe775" />
</head>
<body>

  <div class="app-frame">

    <!-- בחירה בין הורה / ילד -->
    <div class="view-toggle">
      <button class="toggle-btn active" id="parentTab" onclick="openParentView()">הורה 👨‍👧</button>
      <button class="toggle-btn" id="kidTab" onclick="showCard('kid')">ילד 👧</button>
    </div>

    <div id="syncStatusContainer" class="sync-status-container"></div>

    <!-- כרטיס הורה -->
    <section class="card active" id="parentCard" aria-labelledby="parentTab">

      <!-- מצב נעול (לפני סיסמה) -->
      <div id="parentLocked" class="locked-card">
        <div style="font-size:20px;font-weight:600;color:var(--text-dark);margin-bottom:8px;">
          🔒 אזור הורה נעול
        </div>
        <div>הכנס קוד בן 4 ספרות</div>

        <input id="parentPassInput" type="password" maxlength="4" placeholder="••••" />
        <button onclick="tryUnlockParent()">כניסה</button>

        <div class="lock-warn" id="lockWarn"></div>
      </div>

      <!-- מצב פתוח (אחרי סיסמה) -->
      <div id="parentContent" style="display:none;">

        <header class="brand-header">
          <div class="star-icon" aria-hidden="true"></div>
          <div class="brand-text">
            <div class="title">מז״ל</div>
            <div class="subtitle">
              שלום הורה 👋<br />
              הנה המשימות של הילדים להיום
            </div>
          </div>
        </header>

        <div class="progress-wrap">
          <div class="progress-circle" id="overallProgress">0%</div>
          <div class="progress-desc" id="overallText">
            <b>התקדמות כללית להיום</b><br />
            (נטען מהמערכת...)
          </div>
        </div>

        <button class="main-btn" id="openAddTask" onclick="openAddTaskModal()">
          ➕ הוספת משימה חדשה
        </button>

        <button class="sub-btn" id="openManageKids" onclick="openManageKidsModal()">
          ניהול ילדים 👨‍👧➕
        </button>

        <div id="parentKidsArea"></div>
      </div>
    </section>

    <!-- כרטיס ילד -->
    <section class="card" id="kidCard" aria-labelledby="kidTab">

      <header class="brand-header">
        <div class="star-icon" aria-hidden="true"></div>
        <div class="brand-text">
          <div class="title">מז״ל</div>
          <div class="subtitle">
            <span id="kidHeaderName">היי 🧒</span><br />
            אלו המשימות שלך להיום
          </div>
        </div>
      </header>

      <!-- טאבים בין הילדים -->
      <div class="kid-tabs" id="kidTabsArea"></div>

      <!-- טקסט חיזוק אישי -->
      <div class="kid-top-line" id="kidHeadline">...</div>
      <div class="kid-sub-line" id="kidSubline">...</div>

      <!-- משימות של הילד -->
      <div id="kidTasksArea"></div>

      <!-- היסטוריית הודעות -->
      <div id="kidMessagesArea" class="kid-messages-wrapper"></div>

      <!-- הודעה להורה -->
      <div class="send-feedback-area">
        <label for="kidNote">רוצה לשלוח הודעה להורה?</label>
        <textarea
          id="kidNote"
          placeholder="היה לי קשה עם הקיפול 👕"
        ></textarea>
        <button class="send-btn" onclick="sendKidMessage()">שליחה להורה ➜</button>
      </div>
    </section>

    <div class="footer-note">
      מז״ל – משימות, זמן ולב ❤<br />
      גרסה משפחתית בענן
    </div>
  </div>

  <!-- מודאל הוספת משימה -->
  <div class="modal-backdrop" id="taskModalBg">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="close-modal-btn" onclick="closeModal('taskModalBg')" aria-label="סגור">✕</button>

      <h2 id="modalTitle">משימה חדשה</h2>

      <label for="taskChild">למי המשימה?</label>
      <select id="taskChild"></select>

      <label for="taskTitle">שם המשימה</label>
      <input id="taskTitle" placeholder="לסדר את החדר 🧹" />

      <label for="taskMeta">תיאור / יעד</label>
      <textarea
        id="taskMeta"
        placeholder="לפני ארוחת ערב, לבד בלי עזרה"
      ></textarea>

      <button class="save-task-btn" onclick="saveNewTask()">שמור</button>
    </div>
  </div>

  <!-- מודאל תגובת הורה למשימה -->
  <div class="modal-backdrop" id="replyModalBg">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="replyTitle">
      <button class="close-modal-btn" onclick="closeModal('replyModalBg')" aria-label="סגור">✕</button>

      <h2 id="replyTitle">תגובה למשימה</h2>

      <div
        id="replyTaskName"
        style="font-size:14px;color:var(--text-mid);margin-bottom:8px;"
      ></div>

      <label for="replyText">הודעת הורה</label>
      <textarea
        id="replyText"
        placeholder="כל הכבוד על המאמץ 💖"
      ></textarea>

      <button class="save-reply-btn" onclick="saveReply()">שמור תגובה</button>
    </div>
  </div>

  <!-- מודאל ניהול ילדים -->
  <div class="modal-backdrop" id="manageKidsBg">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="manageKidsTitle">
      <button class="close-modal-btn" onclick="closeModal('manageKidsBg')" aria-label="סגור">✕</button>

      <h2 id="manageKidsTitle">ניהול ילדים</h2>

      <div id="kidsList"></div>

      <label for="newKidName">שם ילד חדש</label>
      <input id="newKidName" placeholder="למשל: גיל" />

      <label for="newKidIcon">אייקון/לב לילד</label>
      <input id="newKidIcon" placeholder="💛" />

      <label for="newKidColor">צבע CSS (אפשר 'Pink' / '#a8e1ff')</label>
      <input id="newKidColor" placeholder="var(--yellow)" />

      <button class="manage-kids-btn" onclick="addKid()">הוסף ילד</button>
    </div>
  </div>

  <!-- קוד הלוגיקה (app.js) שטוען גם את db.js -->
  <script type="module" src="app.js"></script>
</body>
</html>
